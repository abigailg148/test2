<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1705429613733149"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polyhedral Die Bias Test</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@600;700&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FF6B9D;
            --secondary: #FEC84D;
            --accent: #4ECDC4;
            --purple: #9B59B6;
            --orange: #FF8C42;
            --green: #51CF66;
            --blue: #5C7CFA;
            --bg: #FFF8F0;
            --text: #2C3E50;
            --shadow: rgba(0, 0, 0, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(255, 107, 157, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(78, 205, 196, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(254, 200, 77, 0.1) 0%, transparent 50%);
            animation: float 20s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -30px) rotate(120deg); }
            66% { transform: translate(-20px, 20px) rotate(240deg); }
        }

        .container {
            max-width: 850px;
            width: 100%;
            background: white;
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 10px 40px var(--shadow);
            border: 3px solid white;
            animation: fadeInUp 0.8s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-family: 'Fredoka', sans-serif;
            font-size: clamp(1.8rem, 5vw, 2.5rem);
            font-weight: 700;
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(135deg, var(--purple) 0%, var(--blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 25px;
            padding: 10px 20px;
            background: linear-gradient(135deg, #E0E0E0 0%, #BDBDBD 100%);
            color: var(--text);
            text-decoration: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.9em;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .back-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .controls {
            background: var(--bg);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 2px solid #E0E0E0;
        }

        .control-group {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .control-group:last-child {
            margin-bottom: 0;
        }

        label {
            font-weight: 600;
            color: var(--purple);
            font-size: 0.95em;
        }

        input[type="number"] {
            padding: 10px 15px;
            border: 2px solid #E0E0E0;
            border-radius: 10px;
            font-size: 1em;
            font-family: 'DM Sans', sans-serif;
            width: 120px;
            transition: all 0.3s ease;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.1);
        }

        button {
            padding: 10px 20px;
            font-family: 'Fredoka', sans-serif;
            font-size: 0.95em;
            font-weight: 600;
            background: linear-gradient(135deg, var(--accent) 0%, #6EDFD9 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(78, 205, 196, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(78, 205, 196, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button.secondary {
            background: linear-gradient(135deg, var(--orange) 0%, #FFA458 100%);
            box-shadow: 0 4px 12px rgba(255, 140, 66, 0.3);
        }

        button.secondary:hover {
            box-shadow: 0 6px 20px rgba(255, 140, 66, 0.4);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 25px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        th {
            background: linear-gradient(135deg, var(--purple) 0%, var(--blue) 100%);
            color: white;
            padding: 15px;
            text-align: center;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            font-size: 1em;
        }

        td {
            border: 1px solid #E0E0E0;
            padding: 12px;
            text-align: center;
            background: white;
        }

        tbody tr:nth-child(even) td {
            background: var(--bg);
        }

        tbody tr:hover td {
            background: rgba(78, 205, 196, 0.1);
            transition: background 0.2s ease;
        }

        .result {
            margin-top: 25px;
            padding: 25px;
            background: var(--bg);
            border-radius: 15px;
            border-left: 4px solid var(--accent);
            line-height: 1.8;
        }

        .result strong {
            font-size: 1.1em;
        }

        .fair {
            color: var(--green);
            font-weight: 700;
        }

        .unfair {
            color: var(--primary);
            font-weight: 700;
        }

        .stat-line {
            margin: 8px 0;
            font-size: 0.95em;
        }

        /* Decorative elements */
        .deco {
            position: fixed;
            pointer-events: none;
            opacity: 0.25;
            z-index: -1;
        }

        .deco-1 {
            top: 15%;
            right: 10%;
            width: 60px;
            height: 60px;
            background: var(--purple);
            border-radius: 50%;
            animation: bounce1 3s ease-in-out infinite;
        }

        .deco-2 {
            bottom: 20%;
            left: 8%;
            width: 50px;
            height: 50px;
            background: var(--accent);
            border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
            animation: bounce2 4s ease-in-out infinite;
        }

        .deco-3 {
            top: 50%;
            left: 12%;
            width: 45px;
            height: 45px;
            background: var(--secondary);
            border-radius: 10px;
            transform: rotate(45deg);
            animation: bounce3 3.5s ease-in-out infinite;
        }

        @keyframes bounce1 {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-25px) rotate(180deg); }
        }

        @keyframes bounce2 {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-20px) scale(1.1); }
        }

        @keyframes bounce3 {
            0%, 100% { transform: rotate(45deg) translateY(0); }
            50% { transform: rotate(225deg) translateY(-15px); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 25px;
            }

            h1 {
                font-size: 1.8rem;
            }

            .control-group {
                flex-direction: column;
                align-items: flex-start;
            }

            input[type="number"] {
                width: 100%;
            }

            button {
                width: 100%;
            }

            table {
                font-size: 0.9em;
            }

            th, td {
                padding: 10px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="deco deco-1"></div>
    <div class="deco deco-2"></div>
    <div class="deco deco-3"></div>

    <div class="container">
        <a href="index.html" class="back-link">üè† Back to Menu</a>
        
        <h1>üé≤ Polyhedral Die Fairness Tester</h1>

        <div class="controls">
            <div class="control-group">
                <label>Number of sides:</label>
                <input type="number" id="sidesInput" min="2" value="6">
                <button onclick="setSides()">Set Die</button>
                <button class="secondary" onclick="resetData()">Reset Rolls</button>
            </div>

            <div class="control-group">
                <label>Enter roll:</label>
                <input type="number" id="rollInput" onkeypress="handleEnter(event)">
                <button onclick="addRoll()">Add Roll</button>
            </div>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Face</th>
                    <th>Observed</th>
                    <th>Expected</th>
                </tr>
            </thead>
            <tbody id="resultsTable"></tbody>
        </table>

        <div class="result" id="chiResult" style="display: none;"></div>
    </div>

    <script>
        let sides = 6;
        let counts = [];
        const ALPHA = 0.01; // 1% significance level

        function setSides() {
            const value = Number(document.getElementById("sidesInput").value);
            if (value < 2 || !Number.isInteger(value)) {
                alert("Number of sides must be an integer ‚â• 2.");
                return;
            }
            sides = value;
            resetData();
        }

        function resetData() {
            counts = new Array(sides).fill(0);
            updateDisplay();
        }

        function addRoll() {
            const value = Number(document.getElementById("rollInput").value);
            if (!Number.isInteger(value) || value < 1 || value > sides) {
                alert(`Please enter a whole number between 1 and ${sides}.`);
                return;
            }
            counts[value - 1]++;
            document.getElementById("rollInput").value = "";
            updateDisplay();
        }

        function handleEnter(event) {
            if (event.key === 'Enter') {
                addRoll();
            }
        }

        function updateDisplay() {
            const tableBody = document.getElementById("resultsTable");
            const totalRolls = counts.reduce((a, b) => a + b, 0);
            const expected = totalRolls / sides;

            tableBody.innerHTML = "";

            for (let i = 0; i < sides; i++) {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td><strong>${i + 1}</strong></td>
                    <td>${counts[i]}</td>
                    <td>${totalRolls === 0 ? "-" : expected.toFixed(2)}</td>
                `;
                tableBody.appendChild(row);
            }

            calculateStats(totalRolls, expected);
        }

        function calculateStats(total, expected) {
            const resultDiv = document.getElementById("chiResult");

            if (total === 0) {
                resultDiv.style.display = "none";
                return;
            }

            resultDiv.style.display = "block";

            /* ---- Chi-squared ---- */
            let chiSquared = 0;
            for (let i = 0; i < sides; i++) {
                chiSquared += Math.pow(counts[i] - expected, 2) / expected;
            }

            const df = sides - 1;
            const pValue = chiSquaredPValue(chiSquared, df);

            /* ---- Bias direction via mean ---- */
            let observedSum = 0;
            for (let i = 0; i < sides; i++) {
                observedSum += counts[i] * (i + 1);
            }

            const observedMean = observedSum / total;
            const expectedMean = (sides + 1) / 2;

            let biasDirection = "No directional bias detected";
            if (pValue < ALPHA) {
                if (observedMean > expectedMean) {
                    biasDirection = "Biased toward higher numbers";
                } else if (observedMean < expectedMean) {
                    biasDirection = "Biased toward lower numbers";
                }
            }

            resultDiv.innerHTML = `
                <div class="stat-line">œá¬≤ = <strong>${chiSquared.toFixed(3)}</strong></div>
                <div class="stat-line">Degrees of freedom = <strong>${df}</strong></div>
                <div class="stat-line">p-value ‚âà <strong>${pValue.toFixed(4)}</strong></div>
                <div class="stat-line">Significance level Œ± = <strong>0.01</strong></div>
                <br>
                ${
                    pValue >= ALPHA
                    ? `<div class="stat-line"><span class="fair">‚úì No significant evidence of unfairness</span></div>`
                    : `<div class="stat-line"><span class="unfair">‚ö† Significant evidence the die is unfair</span></div>`
                }
                <br>
                <div class="stat-line">Observed mean = <strong>${observedMean.toFixed(3)}</strong></div>
                <div class="stat-line">Expected mean = <strong>${expectedMean.toFixed(3)}</strong></div>
                <div class="stat-line"><strong>${biasDirection}</strong></div>
            `;
        }

        /* ---- Chi-squared p-value (incomplete gamma) ---- */
        function chiSquaredPValue(x, k) {
            return gammaincc(k / 2, x / 2);
        }

        function gammaincc(a, x) {
            if (x < 0 || a <= 0) return NaN;
            if (x < a + 1) {
                return 1 - gammaincSeries(a, x);
            } else {
                return gammaincCF(a, x);
            }
        }

        function gammaincSeries(a, x) {
            let sum = 1 / a;
            let value = sum;
            for (let n = 1; n < 100; n++) {
                sum *= x / (a + n);
                value += sum;
            }
            return value * Math.exp(-x + a * Math.log(x) - logGamma(a));
        }

        function gammaincCF(a, x) {
            let b = x + 1 - a;
            let c = 1 / 1e-30;
            let d = 1 / b;
            let h = d;

            for (let i = 1; i < 100; i++) {
                let an = -i * (i - a);
                b += 2;
                d = an * d + b;
                if (Math.abs(d) < 1e-30) d = 1e-30;
                c = b + an / c;
                if (Math.abs(c) < 1e-30) c = 1e-30;
                d = 1 / d;
                h *= d * c;
            }

            return Math.exp(-x + a * Math.log(x) - logGamma(a)) * h;
        }

        function logGamma(z) {
            const cof = [
                76.18009172947146, -86.50532032941677,
                24.01409824083091, -1.231739572450155,
                0.001208650973866179, -0.000005395239384953
            ];
            let x = z;
            let y = z;
            let tmp = x + 5.5;
            tmp -= (x + 0.5) * Math.log(tmp);
            let ser = 1.000000000190015;
            for (let j = 0; j < cof.length; j++) {
                ser += cof[j] / ++y;
            }
            return Math.log(2.5066282746310005 * ser / x) - tmp;
        }

        setSides();
    </script>
</body>
</html>

