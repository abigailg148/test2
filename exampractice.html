<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A-Level Exam Practice</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FF6B9D;
            --secondary: #FEC84D;
            --accent: #4ECDC4;
            --purple: #9B59B6;
            --orange: #FF8C42;
            --green: #51CF66;
            --blue: #5C7CFA;
            --bg: #FFF8F0;
            --text: #2C3E50;
            --shadow: rgba(0, 0, 0, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Lexend', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(255, 107, 157, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(78, 205, 196, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(254, 200, 77, 0.08) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--purple) 100%);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 10px 40px var(--shadow);
            margin-bottom: 30px;
            animation: slideDown 0.6s ease-out 0.1s both;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header h1 {
            font-size: clamp(1.75rem, 5vw, 2.5rem);
            font-weight: 700;
            margin-bottom: 20px;
            letter-spacing: -0.5px;
        }

        .score-board {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .score-item {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .score-item:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .score-item strong {
            display: block;
            font-size: 0.85em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .score-item span {
            font-size: 1.5em;
            font-weight: 700;
        }

        .content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px var(--shadow);
            border: 3px solid white;
        }

        .selection-screen, .question-screen {
            display: none;
        }

        .selection-screen.active, .question-screen.active {
            display: block;
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .form-group {
            margin-bottom: 30px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--purple);
            font-size: 0.95em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        select, input, textarea {
            width: 100%;
            padding: 14px 18px;
            background: var(--bg);
            border: 2px solid #E0E0E0;
            border-radius: 12px;
            color: var(--text);
            font-size: 1em;
            font-family: 'Lexend', sans-serif;
            transition: all 0.3s ease;
        }

        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.1);
        }

        select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%239B59B6' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 18px center;
            padding-right: 45px;
        }

        select:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        textarea {
            resize: vertical;
            min-height: 150px;
            font-family: 'IBM Plex Mono', monospace;
            line-height: 1.6;
        }

        button {
            background: linear-gradient(135deg, var(--accent) 0%, #6EDFD9 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Lexend', sans-serif;
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.4);
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(78, 205, 196, 0.5);
        }

        button:active:not(:disabled) {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        button.secondary {
            background: linear-gradient(135deg, #E0E0E0 0%, #BDBDBD 100%);
            color: var(--text);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        button.secondary:hover:not(:disabled) {
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.15);
        }

        .question-box {
            background: var(--bg);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #E0E0E0;
            position: relative;
        }

        .question-box::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(180deg, var(--primary) 0%, var(--purple) 100%);
            border-radius: 15px 0 0 15px;
        }

        .question-text {
            font-size: 1.1em;
            line-height: 1.8;
            color: var(--text);
            white-space: pre-wrap;
            font-family: 'IBM Plex Mono', monospace;
        }

        .feedback {
            margin-top: 25px;
            padding: 25px;
            border-radius: 15px;
            display: none;
            border: 2px solid;
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .feedback.show {
            display: block;
        }

        .feedback.correct {
            background: rgba(81, 207, 102, 0.1);
            border-color: var(--green);
        }

        .feedback.incorrect {
            background: rgba(255, 107, 157, 0.1);
            border-color: var(--primary);
        }

        .feedback.partial-credit {
            background: rgba(254, 200, 77, 0.1);
            border-color: var(--secondary);
        }

        .feedback h3 {
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .feedback.correct h3 {
            color: var(--green);
        }

        .feedback.incorrect h3 {
            color: var(--primary);
        }

        .feedback.partial-credit h3 {
            color: var(--orange);
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .loading {
            text-align: center;
            padding: 60px 40px;
            display: none;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #E0E0E0;
            border-top: 4px solid var(--accent);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading p {
            color: var(--text);
            font-size: 1.1em;
        }

        .topic-info {
            background: rgba(92, 124, 250, 0.1);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 2px solid rgba(92, 124, 250, 0.3);
            display: grid;
            gap: 8px;
        }

        .topic-info strong {
            color: var(--blue);
        }

        .mark-breakdown {
            background: var(--bg);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border-left: 4px solid var(--accent);
        }

        .mark-breakdown h4 {
            margin-bottom: 12px;
            color: var(--accent);
            font-size: 1em;
        }

        .mark-breakdown p {
            line-height: 1.7;
            white-space: pre-wrap;
        }

        .math-palette {
            background: var(--bg);
            border: 2px solid #E0E0E0;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
        }

        .math-palette.show {
            display: block;
        }

        .math-palette h4 {
            margin: 0 0 15px 0;
            color: var(--purple);
            font-size: 1em;
        }

        .math-symbols {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 10px;
        }

        .math-btn {
            background: white;
            border: 2px solid #E0E0E0;
            border-radius: 10px;
            padding: 10px;
            font-size: 1.3em;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Times New Roman', serif;
            color: var(--text);
        }

        .math-btn:hover {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(78, 205, 196, 0.4);
        }

        .math-btn:active {
            transform: translateY(-1px);
        }

        .symbol-group {
            margin-bottom: 20px;
        }

        .symbol-group:last-child {
            margin-bottom: 0;
        }

        .symbol-group-title {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        @media (max-width: 768px) {
            .content {
                padding: 25px;
            }

            .header {
                padding: 30px 20px;
            }

            .button-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö A-Level Exam Practice</h1>
            <div class="score-board">
                <div class="score-item">
                    <strong>Current Topic</strong>
                    <span id="topic-percentage">--%</span>
                </div>
                <div class="score-item">
                    <strong>Current Subject</strong>
                    <span id="subject-percentage">--%</span>
                </div>
                <div class="score-item">
                    <strong>Overall</strong>
                    <span id="overall-percentage">--%</span>
                </div>
            </div>
            <a href="index.html" style="display: inline-block; margin-top: 20px; padding: 12px 24px; background: rgba(255,255,255,0.2); color: white; text-decoration: none; border-radius: 10px; font-weight: 600; transition: all 0.3s ease; border: 1px solid rgba(255,255,255,0.3);" onmouseover="this.style.background='rgba(255,255,255,0.3)'; this.style.transform='translateY(-2px)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='translateY(0)'">üè† Back to Menu</a>
        </div>

        <div class="content">
            <!-- Selection Screen -->
            <div class="selection-screen active">
                <div class="form-group">
                    <label for="subject-select">Select Subject</label>
                    <select id="subject-select">
                        <option value="">-- Choose a subject --</option>
                        <option value="edexcel-maths">Edexcel A-Level Maths</option>
                        <option value="edexcel-further-maths">Edexcel A-Level Further Maths</option>
                        <option value="ocr-cs">OCR A-Level Computer Science</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="topic-select">Select Topic</label>
                    <select id="topic-select" disabled>
                        <option value="">-- First select a subject --</option>
                    </select>
                </div>

                <button id="start-btn" disabled>Start Practice</button>
            </div>

            <!-- Question Screen -->
            <div class="question-screen">
                <div class="topic-info">
                    <div><strong>Subject:</strong> <span id="current-subject"></span></div>
                    <div><strong>Topic:</strong> <span id="current-topic"></span></div>
                </div>

                <div class="loading">
                    <div class="spinner"></div>
                    <p>Generating your question...</p>
                </div>

                <div id="question-container" style="display: none;">
                    <div class="question-box">
                        <div class="question-text" id="question-text"></div>
                    </div>

                    <div class="form-group">
                        <label for="answer-input">Your Answer</label>
                        <textarea id="answer-input" placeholder="Enter your answer here..."></textarea>
                    </div>

                    <div class="math-palette" id="math-palette">
                        <h4>üìê Mathematical Symbols - Click to Insert</h4>
                        
                        <div class="symbol-group">
                            <div class="symbol-group-title">Powers & Roots</div>
                            <div class="math-symbols">
                                <button class="math-btn" data-symbol="¬≤">x¬≤</button>
                                <button class="math-btn" data-symbol="¬≥">x¬≥</button>
                                <button class="math-btn" data-symbol="‚Å¥">x‚Å¥</button>
                                <button class="math-btn" data-symbol="‚Åµ">x‚Åµ</button>
                                <button class="math-btn" data-symbol="‚Åø">x‚Åø</button>
                                <button class="math-btn" data-symbol="‚àö">‚àö</button>
                                <button class="math-btn" data-symbol="‚àõ">‚àõ</button>
                                <button class="math-btn" data-symbol="‚àú">‚àú</button>
                            </div>
                        </div>

                        <div class="symbol-group">
                            <div class="symbol-group-title">Greek Letters</div>
                            <div class="math-symbols">
                                <button class="math-btn" data-symbol="Œ±">Œ±</button>
                                <button class="math-btn" data-symbol="Œ≤">Œ≤</button>
                                <button class="math-btn" data-symbol="Œ≥">Œ≥</button>
                                <button class="math-btn" data-symbol="Œ¥">Œ¥</button>
                                <button class="math-btn" data-symbol="Œ∏">Œ∏</button>
                                <button class="math-btn" data-symbol="Œª">Œª</button>
                                <button class="math-btn" data-symbol="Œº">Œº</button>
                                <button class="math-btn" data-symbol="œÄ">œÄ</button>
                                <button class="math-btn" data-symbol="œÉ">œÉ</button>
                                <button class="math-btn" data-symbol="œÜ">œÜ</button>
                                <button class="math-btn" data-symbol="œâ">œâ</button>
                                <button class="math-btn" data-symbol="Œî">Œî</button>
                                <button class="math-btn" data-symbol="Œ£">Œ£</button>
                                <button class="math-btn" data-symbol="Œ†">Œ†</button>
                                <button class="math-btn" data-symbol="Œ©">Œ©</button>
                            </div>
                        </div>

                        <div class="symbol-group">
                            <div class="symbol-group-title">Operators & Relations</div>
                            <div class="math-symbols">
                                <button class="math-btn" data-symbol="¬±">¬±</button>
                                <button class="math-btn" data-symbol="‚àì">‚àì</button>
                                <button class="math-btn" data-symbol="√ó">√ó</button>
                                <button class="math-btn" data-symbol="√∑">√∑</button>
                                <button class="math-btn" data-symbol="‚â†">‚â†</button>
                                <button class="math-btn" data-symbol="‚âà">‚âà</button>
                                <button class="math-btn" data-symbol="‚â§">‚â§</button>
                                <button class="math-btn" data-symbol="‚â•">‚â•</button>
                                <button class="math-btn" data-symbol="‚àû">‚àû</button>
                                <button class="math-btn" data-symbol="‚àù">‚àù</button>
                                <button class="math-btn" data-symbol="‚à´">‚à´</button>
                                <button class="math-btn" data-symbol="‚àÇ">‚àÇ</button>
                                <button class="math-btn" data-symbol="‚àá">‚àá</button>
                            </div>
                        </div>

                        <div class="symbol-group">
                            <div class="symbol-group-title">Fractions & Subscripts</div>
                            <div class="math-symbols">
                                <button class="math-btn" data-symbol="¬Ω">¬Ω</button>
                                <button class="math-btn" data-symbol="‚Öì">‚Öì</button>
                                <button class="math-btn" data-symbol="¬º">¬º</button>
                                <button class="math-btn" data-symbol="‚Öî">‚Öî</button>
                                <button class="math-btn" data-symbol="¬æ">¬æ</button>
                                <button class="math-btn" data-symbol="‚ÇÄ">‚ÇÄ</button>
                                <button class="math-btn" data-symbol="‚ÇÅ">‚ÇÅ</button>
                                <button class="math-btn" data-symbol="‚ÇÇ">‚ÇÇ</button>
                                <button class="math-btn" data-symbol="‚ÇÉ">‚ÇÉ</button>
                                <button class="math-btn" data-symbol="‚Çô">‚Çô</button>
                            </div>
                        </div>

                        <div class="symbol-group">
                            <div class="symbol-group-title">Sets & Logic</div>
                            <div class="math-symbols">
                                <button class="math-btn" data-symbol="‚àà">‚àà</button>
                                <button class="math-btn" data-symbol="‚àâ">‚àâ</button>
                                <button class="math-btn" data-symbol="‚à™">‚à™</button>
                                <button class="math-btn" data-symbol="‚à©">‚à©</button>
                                <button class="math-btn" data-symbol="‚äÇ">‚äÇ</button>
                                <button class="math-btn" data-symbol="‚äÜ">‚äÜ</button>
                                <button class="math-btn" data-symbol="‚àÖ">‚àÖ</button>
                                <button class="math-btn" data-symbol="‚àÄ">‚àÄ</button>
                                <button class="math-btn" data-symbol="‚àÉ">‚àÉ</button>
                                <button class="math-btn" data-symbol="¬¨">¬¨</button>
                                <button class="math-btn" data-symbol="‚àß">‚àß</button>
                                <button class="math-btn" data-symbol="‚à®">‚à®</button>
                                <button class="math-btn" data-symbol="‚áí">‚áí</button>
                                <button class="math-btn" data-symbol="‚áî">‚áî</button>
                            </div>
                        </div>

                        <div class="symbol-group">
                            <div class="symbol-group-title">Arrows & Vectors</div>
                            <div class="math-symbols">
                                <button class="math-btn" data-symbol="‚Üí">‚Üí</button>
                                <button class="math-btn" data-symbol="‚Üê">‚Üê</button>
                                <button class="math-btn" data-symbol="‚Üî">‚Üî</button>
                                <button class="math-btn" data-symbol="‚Éó">‚Éó</button>
                                <button class="math-btn" data-symbol="¬∞">¬∞</button>
                                <button class="math-btn" data-symbol="‚à†">‚à†</button>
                                <button class="math-btn" data-symbol="‚ä•">‚ä•</button>
                                <button class="math-btn" data-symbol="‚à•">‚à•</button>
                            </div>
                        </div>
                    </div>

                    <div class="button-group">
                        <button id="submit-btn">Submit Answer</button>
                        <button id="new-question-btn" style="display: none;">Next Question</button>
                        <button id="change-topic-btn" class="secondary">Change Topic</button>
                    </div>

                    <div class="feedback" id="feedback"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Specification details for each subject
        const specifications = {
            'edexcel-maths': {
                'Pure Maths: Algebra and Functions': 'Only include: simplifying expressions, factorising, completing the square, quadratic equations, simultaneous equations, inequalities, functions and mappings, composite and inverse functions, transformations of graphs. A-level standard only.',
                'Pure Maths: Coordinate Geometry': 'Only include: equations of straight lines, parallel and perpendicular lines, circle equations (x-a)¬≤+(y-b)¬≤=r¬≤, parametric equations. A-level standard only.',
                'Pure Maths: Sequences and Series': 'Only include: arithmetic sequences and series, geometric sequences and series, sum to infinity, sigma notation, binomial expansion. A-level standard only.',
                'Pure Maths: Trigonometry': 'Only include: sine and cosine rules, area of triangle, radians, arc length, sector area, trigonometric identities, solving trigonometric equations, small angle approximations. A-level standard only.',
                'Pure Maths: Exponentials and Logarithms': 'Only include: laws of logarithms, exponential functions, solving equations with e and ln. A-level standard only.',
                'Pure Maths: Differentiation': 'Only include: differentiation from first principles, product rule, quotient rule, chain rule, differentiation of sin, cos, tan, e^x, ln(x), stationary points, increasing/decreasing functions, second derivatives. A-level standard only.',
                'Pure Maths: Integration': 'Only include: integration as reverse of differentiation, definite and indefinite integrals, area under curves, integration by substitution, integration by parts, trapezium rule. A-level standard only.',
                'Pure Maths: Vectors': 'Only include: 2D and 3D vectors, magnitude, scalar product, vector equations of lines, angle between vectors. A-level standard only.',
                'Statistics: Data Collection': 'Only include: sampling methods, types of data, cleaning data. A-level standard only.',
                'Statistics: Probability': 'Only include: Venn diagrams, tree diagrams, conditional probability, independent events, mutually exclusive events. A-level standard only.',
                'Statistics: Statistical Distributions': 'Only include: binomial distribution, normal distribution, hypothesis testing for binomial and normal distributions. A-level standard only.',
                'Statistics: Hypothesis Testing': 'Only include: null and alternative hypotheses, significance levels, one-tailed and two-tailed tests, critical values. A-level standard only.',
                'Mechanics: Kinematics': 'Only include: SUVAT equations, displacement-time and velocity-time graphs, constant acceleration, vertical motion under gravity. A-level standard only.',
                'Mechanics: Forces and Newton\'s Laws': 'Only include: resolving forces, equilibrium, Newton\'s laws, friction, connected particles. A-level standard only.',
                'Mechanics: Moments': 'Only include: taking moments, equilibrium of rigid bodies. A-level standard only.'
            },
            'edexcel-further-maths': {
                'Further Pure: Complex Numbers': 'Only include: complex number arithmetic, modulus and argument, Argand diagrams, exponential form, de Moivre\'s theorem, roots of unity. A-level Further Maths standard only.',
                'Further Pure: Matrices': 'Only include: matrix arithmetic, determinants, inverse matrices, linear transformations, eigenvalues and eigenvectors (2√ó2 and 3√ó3 only). A-level Further Maths standard only.',
                'Further Pure: Further Calculus': 'Only include: improper integrals, Maclaurin series, inverse trigonometric functions, further integration techniques. A-level Further Maths standard only.',
                'Further Pure: Further Vectors': 'Only include: vector product, triple scalar product, vector equations of planes, intersection of lines and planes. A-level Further Maths standard only.',
                'Further Pure: Polar Coordinates': 'Only include: converting between polar and Cartesian, sketching polar curves, area in polar coordinates. A-level Further Maths standard only.',
                'Further Pure: Hyperbolic Functions': 'Only include: definitions of sinh, cosh, tanh, identities, inverse hyperbolic functions, solving equations. A-level Further Maths standard only.',
                'Further Pure: Differential Equations': 'Only include: first order differential equations, second order homogeneous equations, particular integrals. A-level Further Maths standard only.',
                'Further Mechanics 1: Momentum and Impulse': 'Only include: impulse-momentum theorem, conservation of momentum, collisions in one dimension, Newton\'s law of restitution. A-level Further Maths standard only.',
                'Further Mechanics 1: Work, Energy and Power': 'Only include: work done by a force, kinetic and potential energy, conservation of energy, power, work-energy principle, efficiency. A-level Further Maths standard only.',
                'Further Mechanics 1: Elastic Strings and Springs': 'Only include: Hooke\'s law, elastic potential energy, elastic strings and springs in equilibrium, vertical motion with elastic strings/springs. A-level Further Maths standard only.',
                'Further Mechanics 1: Elastic Collisions': 'Only include: coefficient of restitution, direct and oblique impacts, Newton\'s experimental law, loss of kinetic energy. A-level Further Maths standard only.',
                'Further Stats 1: Discrete Random Variables': 'Only include: discrete random variables, probability distributions, expectation and variance, E(aX+b), Var(aX+b), cumulative distribution functions. A-level Further Maths standard only.',
                'Further Stats 1: Poisson Distribution': 'Only include: Poisson distribution as a model, mean and variance, using Poisson tables, Poisson approximation to binomial. A-level Further Maths standard only.',
                'Further Stats 1: Continuous Random Variables': 'Only include: continuous random variables, probability density functions, cumulative distribution functions, median and quartiles, expectation and variance. A-level Further Maths standard only.',
                'Further Stats 1: Chi-squared Tests': 'Only include: goodness of fit test, contingency tables, degrees of freedom, critical values, expected frequencies. A-level Further Maths standard only.',
                'Further Stats 1: Probability Generating Functions': 'Only include: probability generating functions, finding mean and variance using PGFs, sum of independent random variables. A-level Further Maths standard only.'
            },
            'ocr-cs': {
                'Component 1: Data Types': 'Only include: primitive data types (integer, real, boolean, character, string), representation of numbers (binary, hex, two\'s complement, floating point), ASCII and Unicode. A-level Computer Science standard only.',
                'Component 1: Data Structures': 'Only include: arrays, records, lists, tuples, stacks, queues, trees, graphs, hash tables. A-level Computer Science standard only.',
                'Component 1: Boolean Algebra': 'Only include: logic gates (AND, OR, NOT, NAND, NOR, XOR), truth tables, Boolean expressions, De Morgan\'s laws, simplification, Karnaugh maps. A-level Computer Science standard only.',
                'Component 1: Software Development': 'Only include: waterfall model, agile, prototyping, spiral model, rapid application development, testing methods, white box and black box testing. A-level Computer Science standard only.',
                'Component 1: Algorithms': 'Only include: searching (linear, binary), sorting (bubble, merge, insertion, quick), Big O notation, dijkstra\'s algorithm, A* algorithm. A-level Computer Science standard only.',
                'Component 1: Programming Paradigms': 'Only include: procedural, object-oriented (classes, objects, inheritance, polymorphism, encapsulation), functional programming concepts. A-level Computer Science standard only.',
                'Component 2: Computer Architecture': 'Only include: Von Neumann architecture, fetch-decode-execute cycle, registers, buses, CPU components, cache memory, RAM, ROM. A-level Computer Science standard only.',
                'Component 2: Communication and Networking': 'Only include: network topologies, TCP/IP model, protocols (HTTP, HTTPS, FTP, SMTP, POP3), IP addressing, subnet masks, client-server and peer-to-peer. A-level Computer Science standard only.',
                'Component 2: Databases': 'Only include: relational databases, SQL (SELECT, INSERT, UPDATE, DELETE, JOIN), normalisation (1NF, 2NF, 3NF), entity relationship diagrams, primary and foreign keys. A-level Computer Science standard only.',
                'Component 2: Operating Systems': 'Only include: role of OS, memory management, scheduling algorithms, interrupts, virtual memory, paging. A-level Computer Science standard only.',
                'Component 2: Legal and Ethical Issues': 'Only include: Data Protection Act, Computer Misuse Act, Copyright law, software licenses, ethical issues in computing. A-level Computer Science standard only.',
                'Component 2: Computational Thinking': 'Only include: abstraction, decomposition, algorithmic thinking, pattern recognition, problem solving. A-level Computer Science standard only.'
            }
        };

        const topics = {
            'edexcel-maths': [
                'Pure Maths: Algebra and Functions',
                'Pure Maths: Coordinate Geometry',
                'Pure Maths: Sequences and Series',
                'Pure Maths: Trigonometry',
                'Pure Maths: Exponentials and Logarithms',
                'Pure Maths: Differentiation',
                'Pure Maths: Integration',
                'Pure Maths: Vectors',
                'Statistics: Data Collection',
                'Statistics: Probability',
                'Statistics: Statistical Distributions',
                'Statistics: Hypothesis Testing',
                'Mechanics: Kinematics',
                'Mechanics: Forces and Newton\'s Laws',
                'Mechanics: Moments'
            ],
            'edexcel-further-maths': [
                'Further Pure: Complex Numbers',
                'Further Pure: Matrices',
                'Further Pure: Further Calculus',
                'Further Pure: Further Vectors',
                'Further Pure: Polar Coordinates',
                'Further Pure: Hyperbolic Functions',
                'Further Pure: Differential Equations',
                'Further Mechanics 1: Momentum and Impulse',
                'Further Mechanics 1: Work, Energy and Power',
                'Further Mechanics 1: Elastic Strings and Springs',
                'Further Mechanics 1: Elastic Collisions',
                'Further Stats 1: Discrete Random Variables',
                'Further Stats 1: Poisson Distribution',
                'Further Stats 1: Continuous Random Variables',
                'Further Stats 1: Chi-squared Tests',
                'Further Stats 1: Probability Generating Functions'
            ],
            'ocr-cs': [
                'Component 1: Data Types',
                'Component 1: Data Structures',
                'Component 1: Boolean Algebra',
                'Component 1: Software Development',
                'Component 1: Algorithms',
                'Component 1: Programming Paradigms',
                'Component 2: Computer Architecture',
                'Component 2: Communication and Networking',
                'Component 2: Databases',
                'Component 2: Operating Systems',
                'Component 2: Legal and Ethical Issues',
                'Component 2: Computational Thinking'
            ]
        };

        let currentSubject = '';
        let currentTopic = '';
        let currentSubjectKey = '';
        let currentQuestion = '';
        let currentAnswer = '';
        let currentTotalMarks = 0;

        // DOM elements
        const subjectSelect = document.getElementById('subject-select');
        const topicSelect = document.getElementById('topic-select');
        const startBtn = document.getElementById('start-btn');
        const selectionScreen = document.querySelector('.selection-screen');
        const questionScreen = document.querySelector('.question-screen');
        const loading = document.querySelector('.loading');
        const questionContainer = document.getElementById('question-container');
        const questionText = document.getElementById('question-text');
        const answerInput = document.getElementById('answer-input');
        const submitBtn = document.getElementById('submit-btn');
        const newQuestionBtn = document.getElementById('new-question-btn');
        const changeTopicBtn = document.getElementById('change-topic-btn');
        const feedback = document.getElementById('feedback');

        // Load or initialize stats
        function getStats() {
            const statsString = localStorage.getItem('examPracticeStats');
            if (statsString) {
                return JSON.parse(statsString);
            }
            return {
                topics: {},
                subjects: {},
                overall: { totalMarks: 0, earnedMarks: 0 }
            };
        }

        function saveStats(stats) {
            localStorage.setItem('examPracticeStats', JSON.stringify(stats));
        }

        function updateStatsDisplay() {
            const stats = getStats();
            
            // Topic percentage
            const topicKey = `${currentSubjectKey}:${currentTopic}`;
            const topicStats = stats.topics[topicKey];
            if (topicStats && topicStats.totalMarks > 0) {
                const topicPercentage = Math.round((topicStats.earnedMarks / topicStats.totalMarks) * 100);
                document.getElementById('topic-percentage').textContent = topicPercentage + '%';
            } else {
                document.getElementById('topic-percentage').textContent = '--%';
            }

            // Subject percentage
            const subjectStats = stats.subjects[currentSubjectKey];
            if (subjectStats && subjectStats.totalMarks > 0) {
                const subjectPercentage = Math.round((subjectStats.earnedMarks / subjectStats.totalMarks) * 100);
                document.getElementById('subject-percentage').textContent = subjectPercentage + '%';
            } else {
                document.getElementById('subject-percentage').textContent = '--%';
            }

            // Overall percentage
            if (stats.overall.totalMarks > 0) {
                const overallPercentage = Math.round((stats.overall.earnedMarks / stats.overall.totalMarks) * 100);
                document.getElementById('overall-percentage').textContent = overallPercentage + '%';
            } else {
                document.getElementById('overall-percentage').textContent = '--%';
            }
        }

        function addQuestionResult(marksEarned, totalMarks) {
            const stats = getStats();
            const topicKey = `${currentSubjectKey}:${currentTopic}`;

            // Update topic stats
            if (!stats.topics[topicKey]) {
                stats.topics[topicKey] = { totalMarks: 0, earnedMarks: 0 };
            }
            stats.topics[topicKey].totalMarks += totalMarks;
            stats.topics[topicKey].earnedMarks += marksEarned;

            // Update subject stats
            if (!stats.subjects[currentSubjectKey]) {
                stats.subjects[currentSubjectKey] = { totalMarks: 0, earnedMarks: 0 };
            }
            stats.subjects[currentSubjectKey].totalMarks += totalMarks;
            stats.subjects[currentSubjectKey].earnedMarks += marksEarned;

            // Update overall stats
            stats.overall.totalMarks += totalMarks;
            stats.overall.earnedMarks += marksEarned;

            saveStats(stats);
            updateStatsDisplay();
        }

        // Update topics when subject changes
        subjectSelect.addEventListener('change', (e) => {
            const subject = e.target.value;
            currentSubjectKey = subject;
            topicSelect.innerHTML = '<option value="">-- Choose a topic --</option>';
            
            if (subject && topics[subject]) {
                topics[subject].forEach(topic => {
                    const option = document.createElement('option');
                    option.value = topic;
                    option.textContent = topic;
                    topicSelect.appendChild(option);
                });
                topicSelect.disabled = false;
            } else {
                topicSelect.disabled = true;
                startBtn.disabled = true;
            }
        });

        // Enable start button when topic is selected
        topicSelect.addEventListener('change', (e) => {
            startBtn.disabled = !e.target.value;
        });

        // Start practice
        startBtn.addEventListener('click', () => {
            currentSubject = subjectSelect.options[subjectSelect.selectedIndex].text;
            currentTopic = topicSelect.value;
            
            document.getElementById('current-subject').textContent = currentSubject;
            document.getElementById('current-topic').textContent = currentTopic;
            
            selectionScreen.classList.remove('active');
            questionScreen.classList.add('active');
            
            // Show math palette for maths subjects
            const mathPalette = document.getElementById('math-palette');
            if (currentSubjectKey === 'edexcel-maths' || currentSubjectKey === 'edexcel-further-maths') {
                mathPalette.classList.add('show');
            } else {
                mathPalette.classList.remove('show');
            }
            
            updateStatsDisplay();
            generateQuestion();
        });

        // Math symbol insertion
        document.getElementById('math-palette').addEventListener('click', (e) => {
            if (e.target.classList.contains('math-btn')) {
                const symbol = e.target.getAttribute('data-symbol');
                const textarea = document.getElementById('answer-input');
                const start = textarea.selectionStart;
                const end = textarea.selectionEnd;
                const text = textarea.value;
                
                // Insert symbol at cursor position
                textarea.value = text.substring(0, start) + symbol + text.substring(end);
                
                // Move cursor after inserted symbol
                textarea.selectionStart = textarea.selectionEnd = start + symbol.length;
                textarea.focus();
            }
        });

        // Predefined question bank for offline use
        const questionBank = {
            'edexcel-maths': {
                'Pure Maths: Algebra and Functions': [
                    {
                        question: "Solve the equation 2x¬≤ + 5x - 3 = 0, giving your answers in exact form. [3 marks]",
                        totalMarks: 3,
                        answer: "Using the quadratic formula: x = (-b ¬± ‚àö(b¬≤ - 4ac)) / 2a\n1 mark: Correct substitution into formula\n1 mark: x = (-5 ¬± ‚àö(25 + 24)) / 4 = (-5 ¬± 7) / 4\n1 mark: x = 1/2 or x = -3"
                    },
                    {
                        question: "Express (x + 3)¬≤ - 5 in the form ax¬≤ + bx + c where a, b and c are constants. [3 marks]",
                        totalMarks: 3,
                        answer: "1 mark: Expand (x + 3)¬≤ = x¬≤ + 6x + 9\n1 mark: Subtract 5: x¬≤ + 6x + 9 - 5\n1 mark: Final answer: x¬≤ + 6x + 4"
                    },
                    {
                        question: "Factorise completely: 3x¬≤ - 12 [2 marks]",
                        totalMarks: 2,
                        answer: "1 mark: Take out common factor 3: 3(x¬≤ - 4)\n1 mark: Recognise difference of two squares: 3(x + 2)(x - 2)"
                    }
                ],
                'Pure Maths: Differentiation': [
                    {
                        question: "Find dy/dx when y = x¬≥ + 4x¬≤ - 2x + 5 [3 marks]",
                        totalMarks: 3,
                        answer: "1 mark: dy/dx = 3x¬≤\n1 mark: + 8x\n1 mark: - 2"
                    },
                    {
                        question: "A curve has equation y = x‚Å¥ - 8x¬≤ + 3. Find the coordinates of the stationary points. [5 marks]",
                        totalMarks: 5,
                        answer: "1 mark: dy/dx = 4x¬≥ - 16x\n1 mark: Set equal to zero: 4x¬≥ - 16x = 0\n1 mark: Factorise: 4x(x¬≤ - 4) = 0, so x = 0, x = ¬±2\n1 mark: Find y-values: (0, 3)\n1 mark: (2, -13) and (-2, -13)"
                    }
                ],
                'Statistics: Probability': [
                    {
                        question: "A bag contains 5 red balls and 3 blue balls. Two balls are selected at random without replacement. Find the probability that both balls are red. [3 marks]",
                        totalMarks: 3,
                        answer: "1 mark: P(1st red) = 5/8\n1 mark: P(2nd red | 1st red) = 4/7\n1 mark: P(both red) = 5/8 √ó 4/7 = 20/56 = 5/14"
                    }
                ],
                'Mechanics: Kinematics': [
                    {
                        question: "A particle moves with constant acceleration 2 m/s¬≤. It has initial velocity 3 m/s. Find the velocity after 5 seconds. [2 marks]",
                        totalMarks: 2,
                        answer: "1 mark: Use v = u + at\n1 mark: v = 3 + 2(5) = 13 m/s"
                    }
                ]
            },
            'edexcel-further-maths': {
                'Further Pure: Complex Numbers': [
                    {
                        question: "Express (2 + 3i)(1 - 2i) in the form a + bi where a and b are real. [3 marks]",
                        totalMarks: 3,
                        answer: "1 mark: Expand: 2 - 4i + 3i - 6i¬≤\n1 mark: Use i¬≤ = -1: 2 - 4i + 3i + 6\n1 mark: Simplify: 8 - i"
                    }
                ],
                'Further Pure: Matrices': [
                    {
                        question: "Find the determinant of the matrix [[3, 2], [1, 4]]. [2 marks]",
                        totalMarks: 2,
                        answer: "1 mark: Use det = ad - bc\n1 mark: det = 3(4) - 2(1) = 12 - 2 = 10"
                    }
                ],
                'Further Stats 1: Poisson Distribution': [
                    {
                        question: "The number of emails received per hour follows a Poisson distribution with mean 3. Find P(X = 2). [3 marks]",
                        totalMarks: 3,
                        answer: "1 mark: Use P(X = r) = (Œª ≥ e^(-Œª)) / r!\n1 mark: Substitute Œª = 3, r = 2\n1 mark: P(X = 2) = (9e^(-3)) / 2 = 4.5e^(-3) ‚âà 0.224"
                    }
                ]
            },
            'ocr-cs': {
                'Component 1: Data Types': [
                    {
                        question: "Convert the binary number 10110101 to hexadecimal. [2 marks]",
                        totalMarks: 2,
                        answer: "1 mark: Split into groups of 4: 1011 0101\n1 mark: 1011‚ÇÇ = B‚ÇÅ‚ÇÜ, 0101‚ÇÇ = 5‚ÇÅ‚ÇÜ, so answer is B5"
                    },
                    {
                        question: "Explain the difference between ASCII and Unicode encoding. [3 marks]",
                        totalMarks: 3,
                        answer: "1 mark: ASCII uses 7/8 bits per character\n1 mark: Unicode uses more bits (typically 16 or 32)\n1 mark: Unicode can represent many more characters including international symbols"
                    }
                ],
                'Component 1: Boolean Algebra': [
                    {
                        question: "Simplify the Boolean expression: A¬∑B + A¬∑BÃÑ [3 marks]",
                        totalMarks: 3,
                        answer: "1 mark: Factor out A: A(B + BÃÑ)\n1 mark: Use law B + BÃÑ = 1\n1 mark: Therefore A¬∑B + A¬∑BÃÑ = A"
                    }
                ],
                'Component 2: Databases': [
                    {
                        question: "Write an SQL query to select all records from a table called 'Students' where the age is greater than 16. [2 marks]",
                        totalMarks: 2,
                        answer: "1 mark: SELECT * FROM Students\n1 mark: WHERE age > 16"
                    }
                ]
            }
        };

        let usedQuestions = {}; // Track which questions have been used per topic

        // Generate question from predefined bank
        function generateQuestion() {
            loading.classList.add('show');
            questionContainer.style.display = 'none';
            feedback.classList.remove('show');
            answerInput.value = '';

            // Simulate loading delay for better UX
            setTimeout(() => {
                const topicQuestions = questionBank[currentSubjectKey]?.[currentTopic];
                
                if (!topicQuestions || topicQuestions.length === 0) {
                    loading.classList.remove('show');
                    questionContainer.style.display = 'block';
                    questionText.textContent = 'No questions available for this topic yet. More questions coming soon!';
                    return;
                }

                // Initialize used questions tracker for this topic
                const topicKey = `${currentSubjectKey}:${currentTopic}`;
                if (!usedQuestions[topicKey]) {
                    usedQuestions[topicKey] = [];
                }

                // Get available questions (not yet used)
                let availableQuestions = topicQuestions.filter((q, index) => 
                    !usedQuestions[topicKey].includes(index)
                );

                // If all questions used, reset
                if (availableQuestions.length === 0) {
                    usedQuestions[topicKey] = [];
                    availableQuestions = topicQuestions;
                }

                // Select random question
                const randomIndex = Math.floor(Math.random() * availableQuestions.length);
                const selectedQuestion = availableQuestions[randomIndex];
                
                // Mark as used
                const originalIndex = topicQuestions.indexOf(selectedQuestion);
                usedQuestions[topicKey].push(originalIndex);

                currentQuestion = selectedQuestion.question;
                currentTotalMarks = selectedQuestion.totalMarks;
                currentAnswer = selectedQuestion.answer;

                questionText.textContent = currentQuestion;
                loading.classList.remove('show');
                questionContainer.style.display = 'block';
                submitBtn.style.display = 'inline-block';
                newQuestionBtn.style.display = 'none';
            }, 800);
        }

        // Simple marking function for offline use
        function markAnswer(userAnswer, correctAnswer) {
            // Simple keyword-based marking
            const answerLines = correctAnswer.split('\n').filter(line => line.includes('mark'));
            let earnedMarks = 0;
            let feedback = '';

            // Very basic marking logic
            const userLower = userAnswer.toLowerCase();
            
            answerLines.forEach(line => {
                const keywords = line.toLowerCase().match(/[a-z0-9+\-*/=()[\]]+/g) || [];
                const matchCount = keywords.filter(keyword => 
                    keyword.length > 2 && userLower.includes(keyword)
                ).length;
                
                if (matchCount > 0) {
                    earnedMarks += 1;
                    feedback += `‚úì ${line}\n`;
                } else {
                    feedback += `‚úó Missed: ${line}\n`;
                }
            });

            earnedMarks = Math.min(earnedMarks, currentTotalMarks);
            
            return { earnedMarks, feedback };
        }

        // Submit answer for marking
        submitBtn.addEventListener('click', () => {
            const userAnswer = answerInput.value.trim();
            
            if (!userAnswer) {
                alert('Please enter an answer before submitting.');
                return;
            }

            submitBtn.disabled = true;
            feedback.innerHTML = '<div class="spinner"></div><p>Marking your answer...</p>';
            feedback.className = 'feedback show';

            // Simulate marking delay
            setTimeout(() => {
                const result = markAnswer(userAnswer, currentAnswer);
                const marksEarned = result.earnedMarks;
                const percentage = Math.round((marksEarned / currentTotalMarks) * 100);

                // Determine feedback class
                let feedbackClass = 'feedback show ';
                if (percentage === 100) {
                    feedbackClass += 'correct';
                } else if (percentage >= 50) {
                    feedbackClass += 'partial-credit';
                } else {
                    feedbackClass += 'incorrect';
                }

                feedback.className = feedbackClass;
                feedback.innerHTML = `
                    <h3>${marksEarned}/${currentTotalMarks} marks (${percentage}%)</h3>
                    <div class="mark-breakdown">
                        <h4>Marking Breakdown:</h4>
                        <p style="white-space: pre-line;">${result.feedback}</p>
                    </div>
                    <div class="mark-breakdown">
                        <h4>Full Marking Scheme:</h4>
                        <p style="white-space: pre-line;">${currentAnswer}</p>
                    </div>
                    <p style="margin-top: 15px; font-size: 0.9em; color: #666;">
                        <strong>Note:</strong> This is automatic marking. Check the marking scheme to ensure your answer matches the required format.
                    </p>
                `;

                addQuestionResult(marksEarned, currentTotalMarks);
                submitBtn.style.display = 'none';
                newQuestionBtn.style.display = 'inline-block';
                submitBtn.disabled = false;
            }, 1000);
        });

        // Next question
        newQuestionBtn.addEventListener('click', () => {
            generateQuestion();
        });

        // Change topic
        changeTopicBtn.addEventListener('click', () => {
            questionScreen.classList.remove('active');
            selectionScreen.classList.add('active');
        });

        // Initialize display on load
        updateStatsDisplay();
    </script>
</body>
</html>
