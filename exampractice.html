<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A-Level Exam Practice</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">

    <style>
        /* --- styles unchanged, trimmed for readability --- */
        body {
            font-family: 'Lexend', sans-serif;
            background: #FFF8F0;
            padding: 20px;
        }
        .container { max-width: 1000px; margin: auto; }
        .selection-screen, .question-screen { display: none; }
        .selection-screen.active, .question-screen.active { display: block; }
        textarea { width: 100%; min-height: 150px; }
        button { padding: 12px 24px; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">

    <div class="selection-screen active">
        <label>Subject</label>
        <select id="subject-select">
            <option value="">-- Choose a subject --</option>
            <option value="edexcel-maths">Edexcel A-Level Maths</option>
            <option value="edexcel-further-maths">Edexcel A-Level Further Maths</option>
            <option value="ocr-cs">OCR A-Level Computer Science</option>
        </select>

        <label>Topic</label>
        <select id="topic-select" disabled>
            <option value="">-- First select a subject --</option>
        </select>

        <button id="start-btn" disabled>Start Practice</button>
    </div>

    <div class="question-screen">
        <h3 id="current-subject"></h3>
        <h4 id="current-topic"></h4>

        <div id="question-text"></div>

        <textarea id="answer-input" placeholder="Write your answer here..."></textarea>

        <button id="show-mark-scheme-btn">Show Mark Scheme</button>
        <button id="change-topic-btn">Change Topic</button>

        <div id="mark-scheme" style="display:none;">
            <h4>Mark Scheme</h4>
            <p id="mark-scheme-text"></p>

            <label>Marks earned</label>
            <input type="number" id="marks-earned" value="0">
            <span> / <span id="total-marks-display"></span></span>

            <button id="submit-marks-btn">Submit</button>
            <button id="next-question-btn" style="display:none;">Next Question</button>
        </div>
    </div>

</div>

<!-- IMPORTANT: questionBank must load first -->
<script src="questionbank.js"></script>

<script>
let currentSubjectKey = '';
let currentSubject = '';
let currentTopic = '';
let currentQuestion = null;
let usedQuestions = {};

const subjectSelect = document.getElementById('subject-select');
const topicSelect = document.getElementById('topic-select');
const startBtn = document.getElementById('start-btn');

const selectionScreen = document.querySelector('.selection-screen');
const questionScreen = document.querySelector('.question-screen');

const questionText = document.getElementById('question-text');
const answerInput = document.getElementById('answer-input');
const markScheme = document.getElementById('mark-scheme');
const markSchemeText = document.getElementById('mark-scheme-text');

const marksEarnedInput = document.getElementById('marks-earned');
const totalMarksDisplay = document.getElementById('total-marks-display');

const submitMarksBtn = document.getElementById('submit-marks-btn');
const nextQuestionBtn = document.getElementById('next-question-btn');
const showMarkSchemeBtn = document.getElementById('show-mark-scheme-btn');
const changeTopicBtn = document.getElementById('change-topic-btn');

/* -------- SUBJECT â†’ TOPICS (FIXED) -------- */
subjectSelect.addEventListener('change', e => {
    currentSubjectKey = e.target.value;

    topicSelect.innerHTML = '<option value="">-- Choose a topic --</option>';
    startBtn.disabled = true;

    if (currentSubjectKey && questionBank[currentSubjectKey]) {
        Object.keys(questionBank[currentSubjectKey]).forEach(topic => {
            const option = document.createElement('option');
            option.value = topic;
            option.textContent = topic;
            topicSelect.appendChild(option);
        });
        topicSelect.disabled = false;
    } else {
        topicSelect.disabled = true;
    }
});

topicSelect.addEventListener('change', e => {
    startBtn.disabled = !e.target.value;
});

/* -------- START PRACTICE -------- */
startBtn.addEventListener('click', () => {
    currentSubject = subjectSelect.options[subjectSelect.selectedIndex].text;
    currentTopic = topicSelect.value;

    document.getElementById('current-subject').textContent = currentSubject;
    document.getElementById('current-topic').textContent = currentTopic;

    selectionScreen.classList.remove('active');
    questionScreen.classList.add('active');

    generateQuestion();
});

/* -------- QUESTION GENERATION -------- */
function generateQuestion() {
    const questions = questionBank[currentSubjectKey][currentTopic];

    const key = `${currentSubjectKey}:${currentTopic}`;
    if (!usedQuestions[key]) usedQuestions[key] = [];

    let available = questions.filter((_, i) => !usedQuestions[key].includes(i));
    if (!available.length) {
        usedQuestions[key] = [];
        available = questions;
    }

    currentQuestion = available[Math.floor(Math.random() * available.length)];
    usedQuestions[key].push(questions.indexOf(currentQuestion));

    questionText.textContent = currentQuestion.question;
    markSchemeText.textContent = currentQuestion.markScheme;
    totalMarksDisplay.textContent = currentQuestion.totalMarks;

    marksEarnedInput.max = currentQuestion.totalMarks;
    marksEarnedInput.value = 0;

    markScheme.style.display = 'none';
    nextQuestionBtn.style.display = 'none';
    submitMarksBtn.style.display = 'inline-block';
}

/* -------- MARK SCHEME -------- */
showMarkSchemeBtn.addEventListener('click', () => {
    markScheme.style.display =
        markScheme.style.display === 'none' ? 'block' : 'none';
});

/* -------- SUBMIT -------- */
submitMarksBtn.addEventListener('click', () => {
    submitMarksBtn.style.display = 'none';
    nextQuestionBtn.style.display = 'inline-block';
});

/* -------- NEXT -------- */
nextQuestionBtn.addEventListener('click', generateQuestion);

/* -------- CHANGE TOPIC -------- */
changeTopicBtn.addEventListener('click', () => {
    questionScreen.classList.remove('active');
    selectionScreen.classList.add('active');
});
</script>

</body>
</html>
